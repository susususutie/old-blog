<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>001-jQuery-slider-img</title>
    <link rel="icon" type="image/x-icon" href="../src/img/icon.png" />

    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        .slider-wrapper {
            position: relative;
            width: 300px;
            height: 200px;
            margin-left: auto;
            margin-right: auto;
            overflow: hidden;
        }

        .slider-wrapper-ul {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 1800px;
            height: 200px;
            overflow: hidden;
            list-style: none;
            font-size: 0px;
        }

        .slider-wrapper-ul-li {
            display: inline-block;
            width: 300px;
            height: 200px;
        }

        .slider-img {
            width: 300px;
            height: 200px;
        }

        .slider-wrapper-index {
            position: absolute;
            bottom: 10px;
            left: 50%;
            margin-left: -55px;
            background-color: #555;
            font-size: 0px;
            padding: 2px;
            border-radius: 13px;
            display: none;
        }

        .index-dots {
            display: inline-block;
            margin: 3px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #fff;
        }

        .index-dots.active-dot {
            background-color: #333;
        }

        .slider-wrapper-left,
        .slider-wrapper-right {
            position: absolute;
            top: 85px;
            width: 20px;
            height: 30px;
            background-color: #555;
            display: none;
        }

        .slider-wrapper-left {
            left: 0px;
            cursor: pointer;
        }

        .slider-wrapper-right {
            right: 0px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="slider-wrapper">
        <ul class="slider-wrapper-ul">
            <li class="slider-wrapper-ul-li"><img src="../src/img/1.jpg" class="slider-img"></li>
            <li class="slider-wrapper-ul-li"><img src="../src/img/2.jpg" class="slider-img"></li>
            <li class="slider-wrapper-ul-li"><img src="../src/img/3.jpg" class="slider-img"></li>
            <li class="slider-wrapper-ul-li"><img src="../src/img/4.jpg" class="slider-img"></li>
            <li class="slider-wrapper-ul-li"><img src="../src/img/5.jpg" class="slider-img"></li>
            <li class="slider-wrapper-ul-li"><img src="../src/img/1.jpg" class="slider-img"></li>
        </ul>
        <ul class="slider-wrapper-index">
            <li class="index-dots active-dot"></li>
            <li class="index-dots"></li>
            <li class="index-dots"></li>
            <li class="index-dots"></li>
            <li class="index-dots"></li>
        </ul>
        <div class="slider-wrapper-left">👈</div>
        <div class="slider-wrapper-right">👉</div>
    </div>

    <script src="../src/js/jquery-v3.4.0.min.js"></script>
    <script>

        var sliderWrapper = $(".slider-wrapper");
        var sliderUl = $(".slider-wrapper-ul");
        var sliderIndex = $(".slider-wrapper-index");
        var indexDots = $(".index-dots");
        var leftBtn = $(".slider-wrapper-left");
        var rightBtn = $(".slider-wrapper-right");

        var imgNum = $(".slider-wrapper-ul-li").length - 1;
        var steep = sliderUl.width() / (imgNum + 1);
        var oldIndex = undefined;
        var nowIndex = 0;
        var moveLock = true;
        var timer;

        bindEvents()
        autoMove("right")

        // 事件绑定
        function bindEvents() {
            // 鼠标滑入事件 使控件显示
            sliderWrapper.on("mouseenter", function () {

                sliderIndex.add(leftBtn).add(rightBtn).show();

                // 索引控件点击事件
                indexDots.on("click", function() {
                    if (moveLock) {
                        clearInterval(timer)
                        moveLock = false;
                        changeIndex($(this).index())
                        autoMove("right")
                    }
                });

                // 右按钮的自定义rightEvent事件，ul右移显示下一张
                rightBtn.on("rightEvent", function () {
                    if (moveLock) {
                        moveLock = false;
                        changeIndex((nowIndex + 1) % 5)
                    }
                });

                // 右按钮点击事件 触发rightEvent
                rightBtn.click(function () {
                    clearInterval(timer)
                    rightBtn.trigger("rightEvent");
                    autoMove("right")
                });

                // 左按钮的自定义leftEvent事件，ul左移显示上一张
                leftBtn.on("leftEvent", function () {
                    if (moveLock) {
                        moveLock = false;
                        changeIndex((nowIndex + 4) % 5)
                    }
                });

                // 左按钮点击事件 触发leftEvent
                leftBtn.click(function () {
                    clearInterval(timer)
                    leftBtn.trigger("leftEvent");
                    autoMove("right")
                });

                // 原先的写法，没有用trigger，直接绑定点击事件
                // leftBtn.add(rightBtn).on("click", function() {
                //     if ($(this).hasClass("slider-wrapper-left") && moveLock) {
                //         moveLock = false;
                //         changeIndex((nowIndex + 4) % 5)
                //     } else if ($(this).hasClass("slider-wrapper-right") && moveLock) {
                //         moveLock = false;
                //         changeIndex((nowIndex + 1) % 5)
                //     }
                // });
            })

            // 鼠标滑出事件 使控件隐藏，删除控件按钮的点击事件，不删除自定义事件
            sliderWrapper.on("mouseleave", function () {
                sliderIndex.add(leftBtn).add(rightBtn).hide();
                leftBtn.add(rightBtn).off("click");
                indexDots.off("click");
            })
        }

        // 移动函数，oldIndex --> nowIndex，出发索引与目标索引不能相等
        function moveByIndex(oldIndex, nowIndex) {
            if (oldIndex == 0 && nowIndex == imgNum - 1) {
                sliderUl.css({left: - imgNum * steep}).animate({left: - nowIndex * steep}, 500, "swing", function() {
                    moveLock = true;
                })
            } else if (oldIndex == imgNum - 1 && nowIndex == 0) {
                sliderUl.animate({left: - (oldIndex + 1) * steep}, 500, "swing", function() {
                    $(this).css({left: 0})
                    moveLock = true;
                })
            } else {
                sliderUl.animate({left: - nowIndex * steep}, 500, "swing", function () {
                    moveLock = true;
                })
            }
        }

        // 自动切换函数 deraction ==> "right" / "left"
        function autoMove(deraction) {
            clearInterval(timer)
            timer = setInterval(function() {
                $(".slider-wrapper-" + deraction).trigger(deraction + "Event");
            }, 1500)
        }

        // 更改索引状态，出发索引与目标索引不等时调用移动函数moveByIndex，参数为想去的目标索引
        function changeIndex(newindex) {
            if (newindex == nowIndex) {
                console.log("same index nochange")
            } else {
                oldIndex = nowIndex;
                nowIndex = newindex;
                // console.log("from: ", oldIndex, "to: ", newindex)
                indexDots.eq(oldIndex).removeClass("active-dot")
                indexDots.eq(nowIndex).addClass("active-dot")
                moveByIndex(oldIndex, nowIndex)
            }
        }

    </script>
</body>

</html>